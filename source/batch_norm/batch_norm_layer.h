#include "../util/data_structs.h"
#include "hls_stream.h"
#include "ap_int.h"
#include "ap_utils.h"

#define EPSILON 0.001

// Batch Norm 1
#define BATCH_NORM_1_BATCHES 1
#define BATCH_NORM_1_INPUT_DIM 16
#define BATCH_NORM_1_INPUT_X 150
#define BATCH_NORM_1_INPUT_Y 50
#define BATCH_NORM_1_OUTPUT_X BATCH_NORM_1_INPUT_X
#define BATCH_NORM_1_OUTPUT_Y BATCH_NORM_1_INPUT_X

static int32_t batchnorm_weights1[64] = {1312552, -150482, 60585024, 248182768, 925478, 10496, 3308, 75650, 1008200, -51678, 1790389, 72590296, 1142240, -200234, 90059112, 331196992, 1208222, -110467, 43447360, 122145312, 1015798, -17514, 9499758, 67040468, 944350, -6423, 11921444, 274333568, 961397, 99590, 1, 2, 916991, 122413, 2, 9, 1070440, -78650, 949399, 38563936, 1176210, -175842, 120804112, 553576256, 1176502, -117662, 84690176, 409582400, 886403, 17033, 5, 17, 956263, -96653, 3208, 71242, 940189, -43050, 1967, 27249, 1013228, 27876, 27843730, 270663808};

// Batch Norm 2
#define BATCH_NORM_2_BATCHES 1
#define BATCH_NORM_2_INPUT_DIM 32
#define BATCH_NORM_2_INPUT_X 75
#define BATCH_NORM_2_INPUT_Y 25
#define BATCH_NORM_2_OUTPUT_X BATCH_NORM_2_INPUT_X
#define BATCH_NORM_2_OUTPUT_Y BATCH_NORM_2_INPUT_X

static int32_t batchnorm_weights2[128] = {1009510, 98555, 200964, 289503, 1083295, -83965, 130284, 107784, 1023596, 49702, 443890, 365434, 1023103, 58006, 108262, 170278, 1002149, 123544, 98825, 114127, 1119035, 32192, 176224, 232221, 1062498, 160175, 197215, 183249, 1017610, 133410, 257342, 326707, 1079023, 44239, 545002, 301177, 1144312, 90438, 198421, 277959, 1100537, 90217, 113351, 144096, 938020, 195663, 526319, 298833, 1107203, 79207, 188761, 283234, 972350, 234836, 138806, 269933, 1078178, 179871, 151272, 201054, 1021704, 128535, 234619, 189359, 1142173, 110134, 295078, 544568, 1071548, 18764, 145844, 163476, 1009804, 20002, 192013, 268465, 1022757, -75868, 317232, 327276, 1006842, 38800, 628862, 432070, 1029385, -20503, 178566, 267105, 1045412, 26820, 127623, 138300, 990863, 65242, 250786, 355625, 1037632, 181502, 378235, 705831, 1015477, 34073, 93692, 204698, 979521, 228773, 390448, 467377, 981135, 57967, 590637, 659332, 1090048, 149444, 935237, 532884, 1015482, 1439, 245584, 212745, 1051346, 88340, 792888, 508666, 1007851, 105790, 415759, 396989};

// Batch Norm 3
#define BATCH_NORM_3_BATCHES 1
#define BATCH_NORM_3_INPUT_DIM 32
#define BATCH_NORM_3_INPUT_X 38
#define BATCH_NORM_3_INPUT_Y 13
#define BATCH_NORM_3_OUTPUT_X BATCH_NORM_3_INPUT_X
#define BATCH_NORM_3_OUTPUT_Y BATCH_NORM_3_INPUT_X

static int32_t batchnorm_weights3[128] = {1561181, 5476, 205969, 260748, 1423079, -2531, 221984, 392516, 1462441, -10335, 121261, 108567, 1387407, -13554, 148547, 218004, 1729480, -18821, 35667, 32126, 1490172, -30851, 68581, 102995, 1474305, -12815, 318138, 311432, 1298860, -21363, 263387, 312094, 1323543, -10167, 254604, 319727, 1412524, -486, 197421, 272043, 1365819, 5881, 277977, 489022, 1607130, -7926, 48484, 57436, 1385280, -28329, 270071, 373007, 1427589, -5724, 162758, 174330, 1327902, -235, 114199, 167087, 1438376, -15805, 191308, 142961, 1618784, -16910, 211213, 191676, 1602716, -20882, 143579, 178086, 1476009, -3808, 152615, 215480, 1354127, -7897, 287342, 330633, 1364896, -2821, 208409, 380021, 1578296, -5647, 198845, 208408, 1626293, -13645, 129926, 185846, 1576201, -35207, 94471, 116076, 1332727, 258, 368886, 651742, 1642005, -28649, 93847, 121346, 1451652, -11080, 280677, 413378, 1453999, -8199, 160814, 192360, 1593129, -13092, 93413, 142934, 1430515, -11222, 285061, 527918, 1515755, -16023, 101181, 53410, 1569585, -12777, 170235, 250026};

void batch_norm1(hls::stream<result_t>& input, 		// where to get inputs
		         hls::stream<result_t>& output);	// where to store outputs


void batch_norm2(hls::stream<result_t>& input, 		// where to get inputs
		         hls::stream<result_t>& output);	// where to store outputs


void batch_norm3(hls::stream<result_t>& input, 		// where to get inputs
		         hls::stream<result_t>& output);	// where to store outputs

